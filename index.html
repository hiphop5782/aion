<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GENIUS 레기온 놀이터</title>

    <!-- bootswatch cdn -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/cosmo/bootstrap.min.css"
        integrity="sha384-5QFXyVb+lrCzdN228VS3HmzpiE7ZVwLQtkt+0d9W43LQMzz4HBnnqvVxKg6O+04d" crossorigin="anonymous">
    <style>
        .btn-check {
            display: none;
        }

        .figure-img {
            width: 100%;
        }

        figure>.qty,
        figure>.lev {
            position: absolute;
            right: 10%;
            bottom: 20%;
            font-size: 1.2rem;
            color: white;
        }

        .result {
            color: gray;
        }
        .result.success {
            color: blue;
        }
        .result.fail{
            color: red;
        }

        .item-slot-wrapper {
            display:flex;
        }
        .item-slot {
            border:1px solid black;
            width:100px;
        }
        .item-slot > img{
            width:100%;
        }
        #recordViewer > .card.card-body {
            display:flex;
            flex-direction: row;
            width:400px;
        }
        figure.record-img{
            width:100%;
        }
        figure.record-img > figcaption {
            font-size: 0.35rem;
        }
    </style>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>
    <div id="app" style="margin-bottom: 200px;">
        <nav class="navbar navbar-expand-md bg-dark navbar-dark">
            <!-- Brand -->
            <a class="navbar-brand" href="https://aion.plaync.com/legions/server/24/id/2548/home">GENIUS Legion</a>

            <!-- Toggler/collapsibe Button -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar links -->
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item" v-for="m in menu">
                        <a class="nav-link" :class="{active:m.active}" href="#"
                            @click="selectMenu(m.name)">{{m.name}}</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container-fluid">
            <div class="row mt-4">
                <div class="col-md-10 offset-md-1">
                    <div class="alert alert-dismissible alert-warning">
                        <h4 class="alert-heading">경고</h4>
                        <p class="mb-0">이 시뮬레이션은 인게임과 동일하지 않으므로 재미로만 즐겨주시길 바랍니다.<br>인게임 실험을 통해 점차 확률을 개선시키고 있습니다.</p>
                    </div>
                </div>
            </div>

            <!-- 아이템 추출 시작 -->
            <div v-show="menu[0].active">
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h1>{{menu[0].name}}</h1>
                    </div>
                </div>
                <hr>
                <div class="row mt-5">
                    <div class="col-md-3 offset-md-1">
                        <h2>아이템 선택</h2>
                    </div>
                    <div class="col-md-7">
                        <select v-model.number="inputItemName" class="form-control" @change="choiceItem">
                            <option value="">선택</option>
                            <option v-for="item in itemList" :value="item.code">
                                [{{item.level}}]
                                {{item.name}}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="row mt-5" v-if="selectedItem">
                    <div class="col-3 offset-1">
                        <figure>
                            <img class="figure-img img-thumbnail" :src="selectedItem.image">
                            <figcaption class="figure-caption text-center">{{selectedItem.name}}</figcaption>
                        </figure>
                    </div>
                    <div class="col-3">
                        <figure>
                            <img class="figure-img img-thumbnail" src="./image/item_pincer.png">
                            <figcaption class="figure-caption text-center">추출 도구</figcaption>
                        </figure>
                    </div>
                    <div class="col-1 text-center">

                    </div>
                    <div class="col-3">
                        <figure v-if="resultStone">
                            <img class="figure-img img-thumbnail"
                                :src="'./image/item_stone_'+(parseInt((resultStone.level-1) / 20))+'.png'">

                            <figcaption class="figure-caption text-center">
                                {{resultStone.level}}레벨 강화석 ({{resultStone.count}})
                            </figcaption>
                            <figcaption class="qty">{{resultStone.count}}</figcaption>
                        </figure>
                    </div>
                    <div class="col-md-10 offset-md-1">
                        <button class="btn btn-warning btn-block" @click="startProgress">추출</button>
                    </div>
                </div>

                <div class="row mt-4" v-if="progress" v-if="selectedItem">
                    <div class="col-md-10 offset-md-1">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" :style="{width: progress + '%'}"
                                aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h6 class="text-center mt-2">{{progress===100?'추출 완료':'추출 중'}}</h6>
                    </div>
                </div>

                <div class="row mt-5">
                    <div class="col-md-10 offset-md-1">
                        <p v-show="record.length > 0">
                            <a class="btn btn-secondary" data-toggle="collapse" href="#recordViewer" role="button" aria-expanded="false" aria-controls="collapseExample">
                                추출 기록 보기
                            </a>
                            <button class="btn btn-danger" @click="clearRecord();">초기화</button>
                        </p>
                        <div class="collapse" id="recordViewer" v-show="record.length > 0">
                            <div class="card card-body" v-for="rec in record">
                                <div class="col">
                                    <figure class="record-img">
                                        <img class="figure-img img-thumbnail" :src="rec.item.image">
                                        <figcaption class="figure-caption text-center">{{rec.item.name}}</figcaption>
                                    </figure>
                                </div>
                                <div class="col">
                                    <figure class="record-img">
                                        <img class="figure-img img-thumbnail" src="./image/item_pincer.png">
                                        <figcaption class="figure-caption text-center">추출 도구</figcaption>
                                    </figure>
                                </div>
                                <div class="col">
                                    <figure class="record-img">
                                        <img class="figure-img img-thumbnail"
                                            :src="'./image/item_stone_'+(parseInt((rec.result.level-1) / 20))+'.png'">
    
                                        <figcaption class="figure-caption text-center">
                                            {{rec.result.level}}레벨 강화석 ({{rec.result.count}})
                                        </figcaption>
                                        <figcaption class="qty">{{rec.result.count}}</figcaption>
                                    </figure> 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <hr>
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h5>추출 계산 공식</h5>
                        <p>
                            아이온 파워북 설명에 기반하며, 실험 데이터가 수집되면 반영할 계획입니다.<br>
                            아이온 아이템 추출 시 강화석 수량이나 레벨은 아이템의 강화 수치와는 무관합니다(공식발표)
                        </p>
                        <h6>강화석 레벨 범위</h6>
                        <ul>
                            <li>영웅 : 다루지 않음</li>
                            <li>유일 : +0 ~ +40 레벨</li>
                            <li>전승 : +0 ~ +20 레벨</li>
                            <li>희귀 : +0 ~ +10 레벨</li>
                            <li>일반 : +0 ~ +5 레벨</li>
                        </ul>

                        <h6>강화석 수량</h6>
                        <ul>
                            <li>영웅 : 다루지 않음</li>
                            <li>유일 :
                                <ul>
                                    <li>영각템 : 무기(~8개), 상의/방패(~6개), 하의(~4개), 어장신(~3개)</li>
                                    <li>거래불가템 : 무기(~3개), 상의/방패/하의(~2개), 어장신(~1개)</li>
                                </ul>
                            </li>
                            <li>전승 : 미구현</li>
                            <li>희귀 : 미구현</li>
                            <li>일반 : 미구현</li>
                        </ul>
                        
                        <h6>확률분포</h6>
                        <p>현재는 아이템 레벨을 평균으로 한 정규분포 우측 부분만 적용중입니다.</p>
                    </div>
                </div>
            </div>
            <!-- 아이템 추출 종료 -->
            
            <!-- 아이템 강화 시작 -->
            <div v-show="menu[1].active">
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h1>{{menu[1].name}}</h1>
                    </div>
                </div>
                <hr>
                
                <div class="row mt-5">
                    <div class="col-md-3 offset-md-1">
                        <h2>아이템 선택</h2>
                    </div>
                    <div class="col-md-7">
                        <select v-model="inputItemName" class="form-control" @change="choiceItem">
                            <option value="">선택</option>
                            <option v-for="item in itemList" :value="item.code">
                                [{{item.level}}]
                                {{item.name}}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="row mt-5" v-if="selectedItem">
                    <div class="col-md-3 offset-md-1">
                        <h2>강화 레벨 선택</h2>
                    </div>
                    <div class="col-md-7">
                        <select v-model.number="currentItemLevel" class="form-control">
                            <option v-for="(v, i) in 16">{{i}}</option>
                        </select>
                    </div>
                </div>

                <div class="row mt-5" v-if="selectedItem">
                    <div class="col-md-3 offset-md-1">
                        <h2>강화석 선택</h2>
                    </div>
                    <div class="col-md-7">
                        <select v-model="enchantStoneLevel" class="form-control">
                            <option v-for="(v,i) in (101-selectedItem.level)">{{i + selectedItem.level}}</option>
                        </select>
                    </div>
                </div>


                <div class="row mt-5" v-if="selectedItem">
                    <div class="col-3 offset-1">
                        <figure>
                            <img class="figure-img img-thumbnail" :src="selectedItem.image">
                            <figcaption class="figure-caption text-center">
                                +{{currentItemLevel}}
                                {{selectedItem.name}}
                            </figcaption>
                            <figcaption class="lev">+{{currentItemLevel}}</figcaption>
                        </figure>
                    </div>
                    <div class="col-3">
                        <figure v-if="enchantStoneLevel > 0">
                            <img class="figure-img img-thumbnail"
                                :src="'./image/item_stone_'+(parseInt((enchantStoneLevel-1) / 20))+'.png'">

                            <figcaption class="figure-caption text-center">
                                {{enchantStoneLevel}}레벨 강화석
                            </figcaption>
                        </figure>
                    </div>
                    <div class="col-1"></div>
                    <div class="col-3">
                        <figure v-if="resultItemLevel != null">
                            <img class="figure-img img-thumbnail" :src="selectedItem.image"
                                :style="'box-shadow: 0 0 10px 3px ' + (enchantResult ? 'blue' : 'red')">
                            <figcaption class="figure-caption text-center">
                                +{{resultItemLevel}}
                                {{selectedItem.name}}
                            </figcaption>
                            <figcaption class="lev">+{{resultItemLevel}}</figcaption>
                        </figure>
                    </div>
                    <div class="col-md-5 offset-md-1">
                        (
                            <span style="color:black;">
                            총 {{enchantCount.total}} 
                            </span>
                            / 
                            <span style="color:blue;">
                            성공 {{enchantCount.success}}
                            </span> 
                            /
                            <span style="color:red">
                            실패 {{enchantCount.fail}}
                            </span>
                        )
                    </div>
                    <div class="col-md-5 text-right" v-if="enchantReady">
                        <button class="btn btn-outline-secondary" @click="clearEnchantResult();">초기화</button>
                        <button class="btn btn-warning" @click="startEnchantProgress" v-if="currentItemLevel < 15"
                            :disabled="resultItemLevel != null && enchantProgress < 100">강화</button>
                        <button class="btn btn-danger" @click="startEnchantProgress2"
                            v-if="resultItemLevel != null && currentItemLevel < 15 && resultItemLevel < 15">계속 강화</button>
                    </div>
                </div>

                <div class="row mt-4" v-if="enchantProgress" v-if="selectedItem">
                    <div class="col-md-10 offset-md-1">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" :style="{width: enchantProgress + '%'}"
                                aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h6 class="text-center mt-2 result"
                            :class="{success:enchantProgress == 100 && enchantResult, fail: enchantProgress == 100 && !enchantResult}">
                            {{enchantResultText}}
                        </h6>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h5>강화 계산 공식</h5>
                        <p>
                            상상과 경험에 기반한 근거 없는 계산 공식입니다.<br>
                            많은 의견 바랍니다.
                        </p>
                        <h6>기본 적용 확률</h6>
                        <ul>
                            <li>영웅 : 다루지 않음</li>
                            <li>유일 : 20레벨 차이나는 강화석으로 강화할 경우 50%로 설정</li>
                            <li>전승 : 15레벨 차이나는 강화석으로 강화할 경우 50%로 설정</li>
                            <li>희귀 : 10레벨 차이나는 강화석으로 강화할 경우 50%로 설정</li>
                            <li>일반 : 5레벨 차이나는 강화석으로 강화할 경우 50%로 설정</li>
                        </ul>

                        강화석 레벨 1당 2%씩 증가 혹은 감소하도록 설정<br>
                        아이온의 강화 확률은 공개되어 있지 않기 때문에 실험을 기반으로 추측하여 적용시킬 계획입니다.<br><br>

                    </div>
                </div>
            </div>
            <!-- 아이템 강화 종료 -->

            <!-- 마석 강화 시작 -->
            <div v-show="menu[2].active">
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h1>{{menu[2].name}}</h1>
                    </div>
                </div>
                <hr>
                
                <div class="row mt-5">
                    <div class="col-md-3 offset-md-1">
                        <h2>소켓 선택</h2>
                    </div>
                    <div class="col-md-7">
                        <select v-model.number="socketCount" class="form-control">
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                            <option>6</option>
                        </select>
                    </div>
                </div>

                <div class="row mt-5">
                    <div class="col-md-3 offset-md-1">
                        <h2>강화 보조제</h2>
                    </div>
                    <div class="col-md-7">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" v-model="isEnchantSupplyUsed">
                            <label class="form-check-label" for="flexSwitchCheckDefault">보조제 사용</label>
                        </div>
                    </div>
                </div>


                <div class="row mt-5">
                    <div class="col-md-10 offset-md-1">
                        <div class="item-slot-wrapper">
                            <div class="item-slot" v-for="socket in socketItem">
                                <img src="./image/item_magicstone_equip.png" v-if="socket">
                                <img src="./image/item_magicstone_empty.png" v-else>
                            </div>
                        </div>
                    </div>
                    <div class="col-7">
                        
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-5 offset-md-1">
                        (
                            <span style="color:black;">
                            총 {{magicStoneCount.total}} 
                            </span>
                            / 
                            <span style="color:blue;">
                            성공 {{magicStoneCount.success}}
                            </span> 
                            /
                            <span style="color:red">
                            실패 {{magicStoneCount.fail}}
                            </span>
                        )
                    </div>
                    <div class="col-md-5 text-right">
                        <button class="btn btn-outline-secondary" @click="clearMagicStoneProgress();">초기화</button>
                        <button class="btn btn-outline-warning" @click="startMagicStoneProgress(3);" :disabled="socketItem[socketCount-1]">{{this.socketItem[this.socketCount-1] ? "강화 완료" : "마석 강화"}}</button>
                    </div>
                </div>

                <div class="row mt-4" v-if="magicStoneProgress" v-if="selectedItem">
                    <div class="col-md-10 offset-md-1">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" :style="{width: magicStoneProgress + '%'}"
                                aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h6 class="text-center mt-2 result" 
                        :class="{success:magicStoneProgress == 100 && magicStoneResult, fail:magicStoneProgress == 100 && !magicStoneResult}">
                            {{magicStoneResultText}}
                        </h6>
                    </div>
                </div>

                <hr>
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h5>마석 강화 계산 공식</h5>
                        <p>
                            파워북 실험실 결과를 참고하였습니다.
                        </p>
                        <h6>기본 적용 확률</h6>
                        <ul>
                            <li>보조제 미사용 : 73%</li>
                            <li>보조제 사용 : 84%</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- 마석 강화 종료 -->
        </div>
    </div>

    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                title: "GENIUS 레기온",
                menu: [{
                        name: "장비 추출",
                        active: true
                    },
                    {
                        name: "장비 강화",
                        active: false
                    },
                    {
                        name: "마석 강화",
                        active: false
                    },
                ],
                inputItemName: "",
                selectedItem: null,
                itemList:[],
                
                progress: 0,
                resultStone: null,
                record:[],

                enchantStoneLevel: 0,
                currentItemLevel: 0,

                enchantProgress: 0,
                resultItemLevel: null,
                enchantResult: false,
                enchantCount:{
                    total:0,
                    success:0,
                    fail:0
                },

                socketCount: 4,
                socketItem:[false, false, false, false],
                isEnchantSupplyUsed: false,
                magicStoneProgress:0,
                magicStoneResult:false,
                magicStoneSuccessCount:0,
                magicStoneCount:{
                    total:0,
                    success:0,
                    fail:0
                },
            },
            computed: {
                enchantReady: function () {
                    return this.selectedItem &&
                        this.enchantStoneLevel > 0 &&
                        this.currentItemLevel >= 0 && this.currentItemLevel <= 15;
                },
                enchantResultText: function () {
                    if (this.enchantProgress < 100)
                        return "강화 중";
                    else if (this.enchantResult)
                        return "강화 성공";
                    else
                        return "강화 실패";
                },
                magicStoneResultText: function(){
                    if(this.magicStoneProgress < 100)
                        return "마석 강화 중";
                    else if(this.magicStoneResult)
                        return "마석 강화 성공";
                    else
                        return "마석 강화 실패";
                },
            },
            watch: {
                socketCount:function(){
                    this.socketItem = [];
                    for(var i=0; i<this.socketCount; i++){
                        this.socketItem.push(false);
                    }
                },
            },
            methods: {
                selectMenu: function (name) {
                    this.menu.forEach(m => {
                        m.active = m.name === name;
                    });
                },
                /* unicode 입력 감지 기능 */
                typing: function (e) {
                    this.inputItemName = e.target.value;
                },
                choiceItem: function () {
                    this.selectItem = null;

                    for (var i = 0; i < this.itemList.length; i++) {
                        console.log(this.itemList[i].code, this.inputItemName);
                        if (this.itemList[i].code == this.inputItemName) {
                            this.selectedItem = Object.assign({}, this.itemList[i]);
                            break;
                        }
                    }

                    this.selectedItem.image = this.choiceItemImage();
                    this.enchantStoneLevel = this.selectedItem.level;
                },
                choiceItemImage: function () {
                    if (!this.selectedItem) return "";
                    switch (this.selectedItem.subType) {
                        case "장검":
                            return "./image/item-weapon-sword.png";
                        case "단검":
                            return "./image/item-weapon-dagger.png";
                        case "양손검":
                            return "./image/item-weapon-twohand.png";
                        case "창":
                            return "./image/item-weapon-lance.png";
                        case "활":
                            return "./image/item-weapon-bow.png";
                        case "지팡이":
                            return "./image/item-weapon-staff.png";
                        case "법서":
                            return "./image/item-weapon-spellbook.png";
                        case "보옥":
                            return "./image/item-weapon-orb.png";
                        case "전곤":
                            return "./image/item-weapon-mace.png";
                        case "방패":
                            return "./image/item-armor-shield.png";
                        case "상의":
                            switch (this.selectedItem.extraType) {
                                case "판금":
                                    return "./image/item-armor-plate-01.png";
                                case "사슬":
                                    return "./image/item-armor-chain-01.png";
                                case "가죽":
                                    return "./image/item-armor-ladder-01.png";
                                case "로브":
                                    return "./image/item-armor-robe-01.png";
                            }
                            case "하의":
                                switch (this.selectedItem.extraType) {
                                    case "판금":
                                        return "./image/item-armor-plate-02.png";
                                    case "사슬":
                                        return "./image/item-armor-chain-02.png";
                                    case "가죽":
                                        return "./image/item-armor-ladder-02.png";
                                    case "로브":
                                        return "./image/item-armor-robe-02.png";
                                }
                                case "어깨":
                                    switch (this.selectedItem.extraType) {
                                        case "판금":
                                            return "./image/item-armor-plate-03.png";
                                        case "사슬":
                                            return "./image/item-armor-chain-03.png";
                                        case "가죽":
                                            return "./image/item-armor-ladder-03.png";
                                        case "로브":
                                            return "./image/item-armor-robe-03.png";
                                    }
                                    case "장갑":
                                        switch (this.selectedItem.extraType) {
                                            case "판금":
                                                return "./image/item-armor-plate-04.png";
                                            case "사슬":
                                                return "./image/item-armor-chain-04.png";
                                            case "가죽":
                                                return "./image/item-armor-ladder-04.png";
                                            case "로브":
                                                return "./image/item-armor-robe-04.png";
                                        }
                                        case "신발":
                                            switch (this.selectedItem.extraType) {
                                                case "판금":
                                                    return "./image/item-armor-plate-05.png";
                                                case "사슬":
                                                    return "./image/item-armor-chain-05.png";
                                                case "가죽":
                                                    return "./image/item-armor-ladder-05.png";
                                                case "로브":
                                                    return "./image/item-armor-robe-05.png";
                                            }
                    }
                },
                clearRecord: function(){
                    this.record = [];
                },
                startProgress: function (second) {
                    this.progress = 0;
                    this.resultStone = null;

                    var proc = () => {
                        this.progress++;
                        if (this.progress < 99) {
                            setTimeout(proc, second / 100);
                        } else {
                            setTimeout(this.afterProgress, 1000);
                            //this.afterProgress();
                        }
                    };

                    setTimeout(proc, 100);
                },
                afterProgress: function () {
                    if (!this.selectedItem) return;
                    this.progress = 100;
                    this.resultStone = {
                        level: this.generateStoneLevelVersion1(this.selectedItem),
                        count: this.generateStoneQuantityVersion1(this.selectedItem)
                    };
                    this.record.push({
                        item:Object.assign({},this.selectedItem),
                        result:this.resultStone
                    });
                },

                /* 추출 레벨 결정 */
                generateStoneLevelVersion1: function (item) {
                    var levelBoundary = this.getStoneLevelBoundary(item);
                    //var level = this.getRandom(item.level, item.level + levelBoundary);
                    var level = this.getTruncGaussianRandom(item.level, item.level + levelBoundary);
                    return level;
                },
                /* 추출 개수 결정 */
                generateStoneQuantityVersion1: function (item) {
                    var countBoundary = this.getStoneCountBoundary(item);
                    //var count = this.getRandom(1, countBoundary);
                    var count = this.getTruncGaussianRandom(1, countBoundary);
                    return count;
                },

                getStoneLevelBoundary: function (item) {
                    switch (item.grade) {
                        case "유일":
                            return 40;
                        case "전승":
                            return 20;
                        case "희귀":
                            return 10;
                        case "일반":
                            return 5;
                    }
                    return null;
                },
                getStoneCountBoundary: function (item) {
                    if (item.type === "무기") {
                        if (item.trade) {
                            switch (item.grade) {
                                case "유일":
                                    return 8;
                                case "전승":
                                    return 6;
                                case "희귀":
                                    return 4;
                                case "일반":
                                    return 2;
                            }
                        } else {
                            switch (item.grade) {
                                case "유일":
                                    return 3;
                                case "전승":
                                    return 2;
                                case "희귀":
                                    return 1;
                                case "일반":
                                    return 1;
                            }
                        }
                    } else if (item.type === "방어구") {
                        if (item.trade) {
                            if (item.subType === "방패") {
                                switch (item.grade) {
                                    case "유일":
                                        return 6;
                                    case "전승":
                                        return 4;
                                    case "희귀":
                                        return 2;
                                    case "일반":
                                        return 1;
                                }
                            } else if (item.subType === "상의") {
                                switch (item.grade) {
                                    case "유일":
                                        return 6;
                                    case "전승":
                                        return 4;
                                    case "희귀":
                                        return 2;
                                    case "일반":
                                        return 1;
                                }
                            } else if (item.subType === "하의") {
                                switch (item.grade) {
                                    case "유일":
                                        return 4;
                                    case "전승":
                                        return 3;
                                    case "희귀":
                                        return 2;
                                    case "일반":
                                        return 1;
                                }
                            } else {
                                /*어장신*/
                                switch (item.grade) {
                                    case "유일":
                                        return 3;
                                    case "전승":
                                        return 2;
                                    case "희귀":
                                        return 1;
                                    case "일반":
                                        return 1;
                                }
                            }
                        } else {
                            if (item.subType === "방패") {
                                switch (item.grade) {
                                    case "유일":
                                        return 2;
                                    case "전승":
                                        return 1;
                                    case "희귀":
                                        return 1;
                                    case "일반":
                                        return 1;
                                }
                            } else if (item.subType === "상의") {
                                switch (item.grade) {
                                    case "유일":
                                        return 2;
                                    case "전승":
                                        return 1;
                                    case "희귀":
                                        return 1;
                                    case "일반":
                                        return 1;
                                }
                            } else if (item.subType === "하의") {
                                switch (item.grade) {
                                    case "유일":
                                        return 2;
                                    case "전승":
                                        return 1;
                                    case "희귀":
                                        return 1;
                                    case "일반":
                                        return 1;
                                }
                            } else {
                                /*어장신*/
                                switch (item.grade) {
                                    case "유일":
                                        return 1;
                                    case "전승":
                                        return 1;
                                    case "희귀":
                                        return 1;
                                    case "일반":
                                        return 1;
                                }
                            }
                        }
                    }
                    return null;
                },
                getRandom: function (start, end) {
                    var s = Math.min(start, end);
                    var e = Math.max(start, end);
                    var range = e - s + 1;
                    var number = Math.floor(Math.random() * range) + s;
                    return number;
                },
                getRayleighRandom: function (start, end) {
                    var s = Math.min(start, end);
                    var e = Math.max(start, end);
                    var range = e - s + 1;
                    return Math.floor(Math.sqrt(-2 * Math.log(1 - Math.random())) * range) + s;
                },
                getTruncGaussianRandom: function (start, end) {
                    var s = Math.min(start, end);
                    var e = Math.max(start, end);
                    var range = e - s + 1;
                    var rnd = Math.abs(this.getGaussianRandom());
                    var val = Math.floor(rnd * range) + s;
                    if (val > end) return this.getTruncGaussianRandom(start, end);
                    return val;
                },
                getGaussianRandom: function () {
                    var v1, v2, s;

                    do {
                        v1 = 2 * Math.random() - 1;
                        v2 = 2 * Math.random() - 1;
                        s = Math.pow(v1, 2) + Math.pow(v2, 2);
                    }
                    while (s >= 1 || s == 0);

                    s = Math.sqrt((-2 * Math.log(s)) / s);

                    var rv = v1 * s;

                    return rv;
                },

                startEnchantProgress: function (second) {
                    if (!this.selectedItem) return;

                    this.enchantProgress = 0;
                    this.resultItemLevel = null;

                    var proc = () => {
                        this.enchantProgress++;
                        if (this.enchantProgress < 99) {
                            setTimeout(proc, second / 100);
                        } else {
                            setTimeout(this.afterEnchantProgress, 1000);
                            //this.afterEnchantProgress();
                        }
                    };

                    setTimeout(proc, 100);
                },
                afterEnchantProgress: function () {
                    if (!this.selectedItem) return;
                    this.enchantProgress = 100;
                    this.resultItemLevel = this.getEnchantResult();
                },
                startEnchantProgress2: function (second) {
                    if (!this.selectedItem) return;

                    this.enchantProgress = 0;
                    this.currentItemLevel = this.resultItemLevel;
                    this.resultItemLevel = null;

                    var proc = () => {
                        this.enchantProgress++;
                        if (this.enchantProgress < 99) {
                            setTimeout(proc, second / 100);
                        } else {
                            setTimeout(this.afterEnchantProgress, 1000);
                            //this.afterEnchantProgress();
                        }
                    };

                    setTimeout(proc, 100);
                },

                clearEnchantResult:function(){
                    this.enchantProgress = 0;
                    this.enchantCount.total = 0;
                    this.enchantCount.success = 0;
                    this.enchantCount.fail = 0;
                },
                /*
                    아이템 강화
                    
                    1. 기본 확률
                    유일 - +20렙을 50%로 설정, 1렙당 2%씩 변동
                    전승 - +15렙을 50%로 설정, 1렙당 2%씩 변동
                    희귀 - +10렙을 50%로 설정, 1렙당 2%씩 변동
                    일반 - +5렙을 50%로 설정, 1렙당 2%씩 변동
                */
                getEnchantResult: function () {
                    if (!this.selectedItem) return;

                    var rate = 50;
                    var gap = this.enchantStoneLevel - this.selectedItem.level;
                    var base;
                    switch (this.selectedItem.grade) {
                        case "유일":
                            base = 20;
                            break;
                        case "전승":
                            base = 15;
                            break;
                        case "희귀":
                            base = 10;
                            break;
                        case "일반":
                            base = 5;
                            break;
                    }
                    rate += (gap - base) * 2;

                    var result = this.getSuccessOrFail(rate);
                    this.enchantCount.total ++;
                    if(result) this.enchantCount.success++;
                    else this.enchantCount.fail++;

                    this.enchantResult = result;

                    if (this.currentItemLevel == 0) {
                        return result ? 1 : 0;
                    } else if (this.currentItemLevel <= 10) {
                        return this.currentItemLevel + (result ? 1 : -1);
                    } else {
                        return result ? this.currentItemLevel + 1 : 10;
                    }
                },
                getSuccessOrFail: function (rate) {
                    var n = Math.floor(Math.random() * 100);
                    return n < rate;
                },

                clearMagicStoneProgress:function(){
                    for(var i=0; i < this.socketItem.length; i++){
                        this.socketItem[i] = false;
                    }
                    this.magicStoneCount.total = 0;
                    this.magicStoneCount.success = 0;
                    this.magicStoneCount.fail = 0;
                },
                startMagicStoneProgress:function(second){
                    if(this.magicStoneSuccessCount == this.socketItem.length) return;

                    this.magicStoneProgress = 0;

                    var proc = () => {
                        this.magicStoneProgress++;
                        if (this.magicStoneProgress < 99) {
                            setTimeout(proc, second / 100);
                        } else {
                            setTimeout(this.afterMagicStoneProgress,1000);
                            //this.afterMagicStoneProgress();
                        }
                    };

                    setTimeout(proc, 100);
                },
                afterMagicStoneProgress:function(){
                    this.magicStoneProgress = 100;

                    var successRate = this.isEnchantSupplyUsed ? 84 : 73;
                    var result = Math.floor(Math.random() * 100) < successRate;

                    this.magicStoneCount.total++;
                    if(result){
                        for(var i=0; i < this.socketItem.length; i++){
                            if(!this.socketItem[i]){
                                this.socketItem[i] = true;
                                break;                                
                            }
                        }
                        this.magicStoneResult = true;
                        this.magicStoneCount.success++;

                        if(this.socketItem[this.socketItem.length-1]){
                            
                        }
                    }
                    else{
                        for(var i=0; i < this.socketItem.length; i++){
                            this.socketItem[i] = false;
                        }
                        this.magicStoneResult = false;
                        this.magicStoneCount.fail++;
                    }
                },
            },
            created:function(){
                axios.get("./json/weapon.json")
                        .then(result=>{
                            for(var i=0; i < result.data.length; i++){
                                this.itemList.push(result.data[i]);
                            }
                        });
                axios.get("./json/armor.json")
                        .then(result=>{
                            for(var i=0; i < result.data.length; i++){
                                this.itemList.push(result.data[i]);
                            }
                        })
            },
        });
    </script>
</body>

</html>